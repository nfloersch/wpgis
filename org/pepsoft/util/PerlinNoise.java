/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

package org.pepsoft.util;

import com.kenperlin.ImprovedNoise;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.Serializable;

/**
 *
 * @author pepijn
 */
public final class PerlinNoise implements Serializable, Cloneable {
    public PerlinNoise(long seed) {
        this.seed = seed;
        improvedNoise = new ImprovedNoise(seed);
    }

    public long getSeed() {
        return seed;
    }

    public void setSeed(long seed) {
        if (seed != this.seed) {
            this.seed = seed;
            improvedNoise = new ImprovedNoise(seed);
        }
    }

    /**
     * Generates one dimensional noise. The input value is normalised to be
     * between 0 (inclusive) and 256 (exclusive), so the input should be
     * constrained to be between those values for best results (otherwise the
     * pattern will start to repeat).
     *
     * @param x The point for which to determine the noise value.
     * @return A noise value between -0.5 and 0.5.
     */
    public float getPerlinNoise(double x) {
        return (float) (improvedNoise.noise(x, 0, 0) * FACTOR);
    }

    /**
     * Generates two dimensional noise. The input values are normalised to be
     * between 0 (inclusive) and 256 (exclusive), so the input should be
     * constrained to be between those values for best results (otherwise the
     * pattern will start to repeat).
     *
     * @param x The X coordinate of the point for which to determine the noise
     *     value.
     * @param y The Y coordinate of the point for which to determine the noise
     *     value.
     * @return A noise value between -0.5 and 0.5.
     */
    public float getPerlinNoise(double x, double y) {
        return (float) (improvedNoise.noise(x, y, 0) * FACTOR);
    }

    /**
     * Generates three dimensional noise. The input values are normalised to be
     * between 0 (inclusive) and 256 (exclusive), so the input should be
     * constrained to be between those values for best results (otherwise the
     * pattern will start to repeat).
     *
     * @param x The X coordinate of the point for which to determine the noise
     *     value.
     * @param y The Y coordinate of the point for which to determine the noise
     *     value.
     * @param z The Z coordinate of the point for which to determine the noise
     *     value.
     * @return A noise value between -0.5 and 0.5.
     */
    public float getPerlinNoise(double x, double y, double z) {
        return (float) (improvedNoise.noise(x, y, z) * FACTOR);
    }
    
    @Override
    public Object clone() {
        try {
            return super.clone();
        } catch (CloneNotSupportedException e) {
            throw new RuntimeException(e);
        }
    }

    public static float getLevelForPromillage(int promillage) {
        if ((promillage < 0) || (promillage > 1000)) {
            throw new IllegalArgumentException();
        }
        return LEVEL_FOR_PROMILLAGE[promillage];
    }

    private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException {
        in.defaultReadObject();

        // Legacy maps
        if (improvedNoise == null) {
            improvedNoise = new ImprovedNoise(seed);
        }
    }

    private long seed;
    private ImprovedNoise improvedNoise;

    private static final double FACTOR = 0.5 / Math.sqrt(0.5);
    private static final long serialVersionUID = 2011040701L;

    private static final float[] LEVEL_FOR_PROMILLAGE = {0.5f, 0.5f, 0.4819336f, 0.4609375f, 0.45166016f, 0.44335938f, 0.4345703f, 0.4262085f, 0.42236328f, 0.41846466f,
        0.4140625f, 0.41101074f, 0.40637207f, 0.4033203f, 0.39746094f, 0.39520264f, 0.38909912f, 0.38682508f, 0.38305664f, 0.37890625f,
        0.3756714f, 0.37304688f, 0.3696289f, 0.36727905f, 0.36546993f, 0.36401367f, 0.36157227f, 0.35986328f, 0.35770035f, 0.3557129f,
        0.3533554f, 0.35211182f, 0.34960938f, 0.34765625f, 0.3460083f, 0.34292603f, 0.3413086f, 0.3400879f, 0.33901978f, 0.33599854f,
        0.33473206f, 0.33325195f, 0.3321228f, 0.3309021f, 0.32962036f, 0.32818604f, 0.32617188f, 0.3251953f, 0.32385254f, 0.32202148f,
        0.32110596f, 0.31982422f, 0.31799316f, 0.3161621f, 0.31445312f, 0.31274414f, 0.31115723f, 0.3100586f, 0.30822754f, 0.30688477f,
        0.3059082f, 0.3050537f, 0.30407715f, 0.30291748f, 0.3022461f, 0.30110168f, 0.30029297f, 0.29901123f, 0.296875f, 0.29589844f,
        0.2935791f, 0.2919922f, 0.2911377f, 0.29005432f, 0.28894043f, 0.28735352f, 0.28631592f, 0.28473473f, 0.28320312f, 0.2824707f,
        0.2803955f, 0.2793274f, 0.27825928f, 0.27734375f, 0.27563477f, 0.2746582f, 0.27331543f, 0.27233887f, 0.27124023f, 0.26923752f,
        0.2680664f, 0.26733398f, 0.26611328f, 0.26464844f, 0.2637329f, 0.2631836f, 0.2619629f, 0.26098633f, 0.26019287f, 0.25868225f,
        0.25794983f, 0.25732422f, 0.2557373f, 0.25427246f, 0.2529297f, 0.2515869f, 0.24985504f, 0.24902344f, 0.24816895f, 0.24694824f,
        0.2454834f, 0.2446289f, 0.2434082f, 0.24246979f, 0.2409668f, 0.2401123f, 0.23919678f, 0.2383728f, 0.23754883f, 0.23709106f,
        0.2364502f, 0.23535156f, 0.23431396f, 0.23344421f, 0.23242188f, 0.23095703f, 0.2296753f, 0.22880554f, 0.22791672f, 0.22680664f,
        0.22601318f, 0.22525406f, 0.22436523f, 0.2232666f, 0.22277832f, 0.22155762f, 0.22076416f, 0.22012329f, 0.2192688f, 0.21850586f,
        0.21756744f, 0.21696472f, 0.21618652f, 0.215271f, 0.21484375f, 0.21398926f, 0.21276855f, 0.2121582f, 0.21148682f, 0.2107544f,
        0.21018982f, 0.20960999f, 0.20861816f, 0.20776367f, 0.20654297f, 0.20568848f, 0.20477295f, 0.20458984f, 0.20397949f, 0.20336914f,
        0.20214844f, 0.20141602f, 0.20043945f, 0.19952393f, 0.19854736f, 0.19805527f, 0.1975708f, 0.19689941f, 0.19598389f, 0.19543457f,
        0.19458008f, 0.19386292f, 0.19334412f, 0.19195557f, 0.190979f, 0.19024658f, 0.18945312f, 0.18902588f, 0.18811035f, 0.18727112f,
        0.1862793f, 0.18525314f, 0.18460083f, 0.18383789f, 0.18310547f, 0.18200684f, 0.18145752f, 0.18115234f, 0.18078518f, 0.18008423f,
        0.17944336f, 0.1786499f, 0.17797852f, 0.17728424f, 0.17669678f, 0.17590332f, 0.17541504f, 0.17468262f, 0.17410278f, 0.17321777f,
        0.17264557f, 0.17218018f, 0.17138672f, 0.17059326f, 0.16967773f, 0.16860962f, 0.1680603f, 0.16728973f, 0.16653442f, 0.16595459f,
        0.16540527f, 0.16482544f, 0.16442871f, 0.16383362f, 0.16308594f, 0.16271973f, 0.1619873f, 0.16113281f, 0.16036797f, 0.15951538f,
        0.15905762f, 0.1585083f, 0.15771484f, 0.15705872f, 0.1565628f, 0.15608883f, 0.15553284f, 0.15509033f, 0.1545105f, 0.15405273f,
        0.15325928f, 0.15267944f, 0.15197754f, 0.15148926f, 0.15080261f, 0.15002441f, 0.14950562f, 0.14907837f, 0.1486206f, 0.14801025f,
        0.14697266f, 0.14628601f, 0.14575195f, 0.1451416f, 0.14428711f, 0.14338684f, 0.1430664f, 0.14245605f, 0.14138794f, 0.14074707f,
        0.14022827f, 0.13970184f, 0.13922119f, 0.13856506f, 0.13791561f, 0.13720703f, 0.13668823f, 0.1362052f, 0.13580322f, 0.13546753f,
        0.13489532f, 0.13452148f, 0.1339798f, 0.13366699f, 0.13256836f, 0.13191223f, 0.13134766f, 0.13098145f, 0.13026428f, 0.1293335f,
        0.12890625f, 0.1279602f, 0.1275177f, 0.12677002f, 0.1262207f, 0.12557983f, 0.1248703f, 0.12410545f, 0.12335205f, 0.12286377f,
        0.122558594f, 0.12200928f, 0.121170044f, 0.1204834f, 0.11987305f, 0.119125366f, 0.11868286f, 0.11828613f, 0.117614746f, 0.1171875f,
        0.117004395f, 0.11584473f, 0.11520386f, 0.114601135f, 0.113349915f, 0.1126709f, 0.11219025f, 0.11160278f, 0.110961914f, 0.110565186f,
        0.109802246f, 0.10913086f, 0.10864544f, 0.10838318f, 0.10772705f, 0.107299805f, 0.10662842f, 0.10624695f, 0.105651855f, 0.1048584f,
        0.10420227f, 0.10360718f, 0.102996826f, 0.10241699f, 0.101468086f, 0.10107422f, 0.10058594f, 0.1000061f, 0.09941292f, 0.09875488f,
        0.09814453f, 0.097473145f, 0.0965271f, 0.095703125f, 0.095321655f, 0.09436035f, 0.09375f, 0.09301758f, 0.09249878f, 0.0919013f,
        0.09140015f, 0.09082031f, 0.09033203f, 0.08972168f, 0.08917236f, 0.08868408f, 0.08804321f, 0.087646484f, 0.08734131f, 0.0864563f,
        0.0859375f, 0.085502625f, 0.0848999f, 0.084480286f, 0.08380127f, 0.0832901f, 0.0827713f, 0.08215332f, 0.08153534f, 0.08087158f,
        0.08035278f, 0.079833984f, 0.07922363f, 0.07885742f, 0.07824707f, 0.07788086f, 0.07727051f, 0.07613373f, 0.07543945f, 0.0748291f,
        0.07421875f, 0.07348633f, 0.07287598f, 0.07255554f, 0.07220459f, 0.07159424f, 0.07109833f, 0.07069397f, 0.0700531f, 0.06958008f,
        0.0692749f, 0.0689621f, 0.068481445f, 0.068115234f, 0.06750488f, 0.06677246f, 0.06616211f, 0.06567383f, 0.06530762f, 0.064575195f,
        0.06391144f, 0.06347656f, 0.06304932f, 0.0625f, 0.061645508f, 0.06124878f, 0.06048584f, 0.059936523f, 0.059387207f, 0.058944702f,
        0.058347225f, 0.057949066f, 0.057373047f, 0.0569458f, 0.056640625f, 0.056152344f, 0.05550766f, 0.054998398f, 0.05456543f, 0.054244995f,
        0.053833008f, 0.053375244f, 0.05267334f, 0.052001953f, 0.051483154f, 0.051174164f, 0.050460815f, 0.050048828f, 0.049316406f, 0.048736572f,
        0.047607422f, 0.0471344f, 0.046447754f, 0.046173573f, 0.045776367f, 0.045318604f, 0.044677734f, 0.044189453f, 0.0435791f, 0.04321289f,
        0.04296875f, 0.042114258f, 0.04168701f, 0.040771484f, 0.040283203f, 0.039733887f, 0.039215088f, 0.03882599f, 0.038330078f, 0.037841797f,
        0.036987305f, 0.036315918f, 0.03579712f, 0.03540039f, 0.035087585f, 0.034606934f, 0.034179688f, 0.033691406f, 0.03314209f, 0.032714844f,
        0.03239441f, 0.032104492f, 0.03149414f, 0.030700684f, 0.02999878f, 0.029541016f, 0.028808594f, 0.028198242f, 0.02734375f, 0.026855469f,
        0.026412964f, 0.02609253f, 0.025665283f, 0.025099277f, 0.024810791f, 0.024299622f, 0.023925781f, 0.023521423f, 0.02281189f, 0.022094727f,
        0.02152443f, 0.020996094f, 0.020751953f, 0.020385742f, 0.01979065f, 0.01928711f, 0.018737793f, 0.018310547f, 0.017700195f, 0.01727295f,
        0.016845703f, 0.016403198f, 0.01586914f, 0.015075684f, 0.0146484375f, 0.014312744f, 0.013886452f, 0.013122559f, 0.012756348f, 0.012481689f,
        0.011962891f, 0.011352539f, 0.010620117f, 0.010284424f, 0.009765625f, 0.009277344f, 0.008728027f, 0.008544922f, 0.008117676f, 0.0076904297f,
        0.007080078f, 0.0063934326f, 0.00592041f, 0.005432129f, 0.0048675537f, 0.004425049f, 0.003967285f, 0.0030517578f, 0.0027160645f, 0.0021972656f,
        0.001449585f, 0.0010070801f, 6.713867E-4f, 1.5258789E-4f, -3.6621094E-4f, -9.765625E-4f, -0.0014648438f, -0.0019836426f, -0.002319336f, -0.0028076172f,
        -0.0032958984f, -0.0037231445f, -0.004272461f, -0.004638672f, -0.0051116943f, -0.0056152344f, -0.0059661865f, -0.0063171387f, -0.006958008f, -0.0074920654f,
        -0.007843018f, -0.008544922f, -0.008972168f, -0.009399414f, -0.009887695f, -0.010556221f, -0.011230469f, -0.011810303f, -0.012390137f, -0.012710571f,
        -0.013671875f, -0.014160156f, -0.0146484375f, -0.015380859f, -0.015930176f, -0.016235352f, -0.017089844f, -0.017578125f, -0.018310547f, -0.018615723f,
        -0.01928711f, -0.01965332f, -0.020324707f, -0.020690918f, -0.0211792f, -0.021728516f, -0.022232056f, -0.022666931f, -0.023071289f, -0.023376465f,
        -0.023986816f, -0.025054932f, -0.025669098f, -0.026245117f, -0.026504517f, -0.026977539f, -0.027542114f, -0.028060913f, -0.028690338f, -0.02911377f,
        -0.029541016f, -0.029994965f, -0.030639648f, -0.03125f, -0.031593323f, -0.032287598f, -0.03265381f, -0.03314209f, -0.033569336f, -0.03401947f,
        -0.0344162f, -0.03479004f, -0.03527832f, -0.03564453f, -0.036102295f, -0.036865234f, -0.037322998f, -0.037902832f, -0.038482666f, -0.038879395f,
        -0.03967285f, -0.040216446f, -0.040802002f, -0.041870117f, -0.042114258f, -0.042419434f, -0.042907715f, -0.043441772f, -0.043945312f, -0.044433594f,
        -0.045013428f, -0.045410156f, -0.04586792f, -0.046325684f, -0.046829224f, -0.047302246f, -0.047714233f, -0.04805112f, -0.04866028f, -0.04937744f,
        -0.049865723f, -0.050201416f, -0.050720215f, -0.051132202f, -0.05154419f, -0.051940918f, -0.05255127f, -0.05307007f, -0.053710938f, -0.054382324f,
        -0.055114746f, -0.055480957f, -0.05621338f, -0.05682373f, -0.05718994f, -0.057739258f, -0.05834961f, -0.05885887f, -0.059318542f, -0.060180664f,
        -0.06085205f, -0.061645508f, -0.0625f, -0.06286621f, -0.06348419f, -0.06402588f, -0.06489563f, -0.065338135f, -0.06604004f, -0.06640625f,
        -0.06685257f, -0.06730652f, -0.067871094f, -0.068481445f, -0.06933594f, -0.07006836f, -0.070495605f, -0.07116699f, -0.07156372f, -0.072021484f,
        -0.07269287f, -0.07324219f, -0.074035645f, -0.074645996f, -0.07531738f, -0.07595062f, -0.07632446f, -0.076660156f, -0.07739258f, -0.07810974f,
        -0.07861328f, -0.079055786f, -0.079711914f, -0.08026123f, -0.08052063f, -0.08129883f, -0.08162689f, -0.08239746f, -0.08312988f, -0.08383179f,
        -0.084472656f, -0.08520508f, -0.08566713f, -0.08605957f, -0.08706665f, -0.08758545f, -0.08824921f, -0.08886719f, -0.08959961f, -0.09030151f,
        -0.09063721f, -0.09124756f, -0.09152222f, -0.09194946f, -0.092437744f, -0.09338379f, -0.093948364f, -0.09460449f, -0.09527588f, -0.09579468f,
        -0.09624481f, -0.09692383f, -0.09741211f, -0.097854614f, -0.09855652f, -0.09899902f, -0.1000061f, -0.10058594f, -0.10133362f, -0.10223389f,
        -0.1027832f, -0.103178024f, -0.104003906f, -0.10449219f, -0.10522461f, -0.10614014f, -0.10668945f, -0.107421875f, -0.1081543f, -0.10864258f,
        -0.10913086f, -0.10974121f, -0.110839844f, -0.11128235f, -0.111816406f, -0.11248779f, -0.11303711f, -0.113983154f, -0.11450195f, -0.115112305f,
        -0.11567688f, -0.116025925f, -0.11663818f, -0.11743164f, -0.11816406f, -0.11831665f, -0.11862564f, -0.11920166f, -0.119628906f, -0.12017822f,
        -0.12097168f, -0.12155151f, -0.121917725f, -0.12265015f, -0.123413086f, -0.12420654f, -0.12475586f, -0.12541199f, -0.12569427f, -0.12626648f,
        -0.12701416f, -0.12738037f, -0.12780762f, -0.1284256f, -0.12939453f, -0.12976074f, -0.13043213f, -0.13098145f, -0.131526f, -0.13195801f,
        -0.13259888f, -0.13317871f, -0.13366699f, -0.13404465f, -0.13467407f, -0.13529968f, -0.1359253f, -0.13641357f, -0.13696289f, -0.13745117f,
        -0.13806915f, -0.13873291f, -0.13928223f, -0.13970947f, -0.14056396f, -0.14118958f, -0.14152527f, -0.14215851f, -0.14297485f, -0.14355469f,
        -0.14398193f, -0.14455414f, -0.14516449f, -0.14556885f, -0.14608765f, -0.14689636f, -0.14770508f, -0.14831543f, -0.14941406f, -0.14984131f,
        -0.15045166f, -0.1508789f, -0.15155792f, -0.15214539f, -0.15283203f, -0.15332031f, -0.15429688f, -0.15496063f, -0.15527344f, -0.15572357f,
        -0.15637207f, -0.15698242f, -0.15775299f, -0.15814209f, -0.15853882f, -0.15917969f, -0.16015625f, -0.1607666f, -0.16156006f, -0.16247559f,
        -0.16326904f, -0.16363525f, -0.16442871f, -0.16513062f, -0.16619873f, -0.16696167f, -0.16748047f, -0.16807556f, -0.1685791f, -0.1689148f,
        -0.16932678f, -0.17004395f, -0.17062378f, -0.17112732f, -0.17150879f, -0.17211914f, -0.17248535f, -0.17315674f, -0.17392159f, -0.17443848f,
        -0.17553711f, -0.17599487f, -0.17663574f, -0.17736816f, -0.17785645f, -0.17883301f, -0.17944336f, -0.17980194f, -0.18041992f, -0.18151855f,
        -0.18219757f, -0.18252563f, -0.18341064f, -0.18371582f, -0.18437195f, -0.1852417f, -0.18598175f, -0.18676758f, -0.18737793f, -0.18817139f,
        -0.18896484f, -0.18953323f, -0.19050598f, -0.19104004f, -0.19165039f, -0.19238281f, -0.19348145f, -0.19433594f, -0.19528198f, -0.19604492f,
        -0.19677734f, -0.19726562f, -0.1977539f, -0.19909668f, -0.20007324f, -0.20062256f, -0.20153809f, -0.20239258f, -0.20361328f, -0.20404053f,
        -0.20526123f, -0.206604f, -0.20751953f, -0.20800781f, -0.20874023f, -0.20996094f, -0.21069336f, -0.21154785f, -0.21246338f, -0.2131958f,
        -0.21404266f, -0.21466064f, -0.21575928f, -0.21655273f, -0.21752548f, -0.21795654f, -0.22021484f, -0.22088623f, -0.22177124f, -0.22241211f,
        -0.22314453f, -0.22377396f, -0.2243805f, -0.2253418f, -0.22668457f, -0.22769165f, -0.22857666f, -0.22912598f, -0.22961426f, -0.23046875f,
        -0.23138094f, -0.23210144f, -0.23303223f, -0.23348999f, -0.23376465f, -0.23449707f, -0.23535156f, -0.23602295f, -0.23706055f, -0.23779297f,
        -0.23864746f, -0.23956299f, -0.24023438f, -0.24121094f, -0.24232483f, -0.24316406f, -0.24414062f, -0.24578857f, -0.24658203f, -0.24743652f,
        -0.24908447f, -0.25048828f, -0.2518921f, -0.25305176f, -0.25408936f, -0.25543213f, -0.25598145f, -0.2578125f, -0.25878906f, -0.26068115f,
        -0.26184082f, -0.26287842f, -0.26452637f, -0.2658081f, -0.26757812f, -0.26879883f, -0.2694111f, -0.27096558f, -0.27172852f, -0.2723999f,
        -0.2733612f, -0.27441406f, -0.27539062f, -0.2767334f, -0.27844238f, -0.27941895f, -0.2802124f, -0.28155518f, -0.28271484f, -0.28393555f,
        -0.2850952f, -0.28604126f, -0.28686523f, -0.28796387f, -0.28955078f, -0.29125977f, -0.29296875f, -0.29467773f, -0.29711914f, -0.2984619f,
        -0.29943848f, -0.30114746f, -0.30322266f, -0.30529785f, -0.30670166f, -0.30859375f, -0.3100586f, -0.31158447f, -0.3133545f, -0.31506348f,
        -0.31591797f, -0.31713867f, -0.31982422f, -0.321167f, -0.32250977f, -0.3239746f, -0.32629395f, -0.32702637f, -0.3284912f, -0.33007812f,
        -0.33187866f, -0.33398438f, -0.33566284f, -0.33691406f, -0.33935547f, -0.3408203f, -0.34274292f, -0.3449707f, -0.34716797f, -0.34899902f,
        -0.35107422f, -0.35351562f, -0.35595703f, -0.35766602f, -0.35925293f, -0.3605957f, -0.36328125f, -0.36621094f, -0.37060547f, -0.37353516f,
        -0.37597656f, -0.3798828f, -0.38232422f, -0.38476562f, -0.38867188f, -0.39111328f, -0.39892578f, -0.40545654f, -0.40982056f, -0.41308594f,
        -0.41748047f, -0.4248047f, -0.4309082f, -0.43637085f, -0.4428711f, -0.44873047f, -0.45898438f, -0.46679688f, -0.484375f, -0.5f,
        -0.5f};
}